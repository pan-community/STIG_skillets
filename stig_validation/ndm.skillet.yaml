---

name: NDM_Validation
label: skillet generated from NDM STIG documents at stigviewer.com

description: This skillet accounts NDM STIG sersions

type: pan_validation
labels:
    collection:
        - stig
        - Validation

variables:

  - name: emergency_admin_account
    description: Emergency administration account  
    type_hint: text
    default: emergency

  - name: permit_http_ocsp
    description: HTTP OCSP permitted on management interface
    type_hint: dropdown
    default: false
    dd_list:
      - key: Yes
        value: true
      - key: No
        value: false

  - name: permit_userid_syslog_listener_ssl
    description: User-ID syslog listener permitted on management interface
    type_hint: dropdown
    default: false
    dd_list:
      - key: Yes
        value: true
      - key: No
        value: false

  - name: permit_userid
    description: User-ID permitted on management interface
    type_hint: dropdown
    default: false
    dd_list:
      - key: Yes
        value: true
      - key: No
        value: false

  - name: centralized_authentication
    description: Centralized authentication protocol in use
    type_hint: dropdown
    default: kerberos
    dd_list:
      - key: Kerberos
        value: kerberos
      - key: LDAP
        value: ldap
      - key: RADIUS
        value: radius

  - name: authorized_no_idle_timeout
    description: Emergency administration account  
    type_hint: dropdown
    default: false
    dd_list:
      - key: Yes
        value: true
      - key: No
        value: false

  - name: admin_verified_ntp_geographic_diversity
    description: NTP servers verified in different geographic regions
    type_hint: dropdown
    default: false
    dd_list:
      - key: Yes
        value: true
      - key: No
        value: false
snippets:

    - name: capture_failed_login
      cmd: parse
      variable: config
      outputs:
        - name: vaild_authentication_profiles
          capture_list: /config/shared/authentication-profile/entry[lockout/failed-attempts=3]/@name
        - name: invalid_admin_users
          capture_list: /config/mgt-config/users/entry
          filter_items: |
            not item.entry["@name"] in emergency_admin_account | listify
            and not item.entry['authentication-profile'] in vaild_authentication_profiles
      tags:
        - PANW-NM-000015

    - name: PANW-NM-000015
      label: The Palo Alto Networks security platform must enforce the limit of three consecutive invalid logon attempts.
      meta:
        stig: ndm
        severity: medium
      test: vaild_authentication_profiles and not invalid_admin_users
      fail_message: |
        {% if not vaild_authentication_profiles %}No vaild authentication profiles found{% endif %}
        {% if invalid_admin_users %}Admin users with invalid auth profile - {% for user in invalid_admin_users %}{{ user.entry["@name"] }} {% endfor %}{% endif %}
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62705
      tags:
        - PANW-NW-000015

    - name: PANW-NM-000016
      label: The Palo Alto Networks security platform must display the Standard Mandatory DoD Notice and Consent Banner before granting access to the device.
      meta:
        stig: ndm
        severity: low
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62707
      tags:
        - PANW-NW-000016

    - name: PANW-NM-000023
      label: The Palo Alto Networks security platform must allow only the ISSM (or individuals or roles appointed by the ISSM) in the Audit Administrator (auditadmin) role, or in a custom role with full access to audit logs, or any account that has full access to audit logs.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62709
      tags:
        - PANW-NW-000023

    - name: capture_system_syslog
      cmd: parse
      variable: config
      outputs:
        - name: system_syslog
          capture_list: /config/shared/log-settings/system/match-list/entry[send-syslog/member]
        - name: system_syslog_filters
          capture_expression: system_syslog | json_query("[].entry.filter | join(' , ', @)")
        - name: valid_traffic_syslog_profile_names
          capture_list: |
            /config/devices/entry[@name="localhost.localdomain"]/vsys/entry[@name="vsys1"]/log-settings
            /profiles/entry[match-list/entry/log-type="traffic" and match-list/entry/send-syslog/member]/@name
        - name: valid_threat_syslog_profile
          capture_list: |
            /config/devices/entry[@name="localhost.localdomain"]/vsys/entry[@name="vsys1"]/log-settings
            /profiles/entry[match-list/entry/log-type="threat" and match-list/entry/send-syslog/member]
          filter_items: |
            "All Logs" in item | json_query('entry."match-list".entry[? "send-syslog"].filter | join(` , `, @)')
            or (
              "critical" in item | json_query('entry."match-list".entry[? "send-syslog"].filter | join(` , `, @)')
              and "high" in item | json_query('entry."match-list".entry[? "send-syslog"].filter | join(` , `, @)')
              and "medium" in item | json_query('entry."match-list".entry[? "send-syslog"].filter | join(` , `, @)')
              and "low" in item | json_query('entry."match-list".entry[? "send-syslog"].filter | join(` , `, @)')
              and "informational" in item | json_query('entry."match-list".entry[? "send-syslog"].filter | join(` , `, @)')
            )
        - name: valid_threat_syslog_profile_names
          capture_expression: valid_threat_syslog_profile | json_query('[].entry."@name"')
        - name: valid_config_syslog_profile_names
          capture_list: /config/shared/log-settings/config/match-list/entry[send-syslog/member]/@name
      tags:
        - PANW-NM-000024
        - PANW-NM-000042
        - PANW-NM-000128

    - name: PANW-NM-000024
      label: The Palo Alto Networks security platform must generate audit records when successful/unsuccessful attempts to access privileges occur.
      meta:
        stig: ndm
        severity: medium
      test: |
        'All Logs' in system_syslog_filters
        or ( 'critical' in system_syslog_filters and 'high' in system_syslog_filters
          and 'medium' in system_syslog_filters and 'low' in system_syslog_filters and 'informational' in system_syslog_filters )
      fail_message: Not all syslog levels are accounted for in system logs, view link for more information.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62711
      tags:
        - PANW-NW-000024

    - name: capture_system_management_settings
      cmd: parse
      variable: config
      outputs:
        - name: system_hostname
          capture_value: /config/devices/entry/deviceconfig/system/hostname/text()
        - name: system_syslog_hostname
          capture_value: /config/devices/entry/deviceconfig/setting/management/hostname-type-in-syslog/text()
      tags:
        - PANW-NM-000029

    - name: PANW-NM-000029
      label: The Palo Alto Networks security platform must produce audit log records containing information (FQDN, unique hostname, management IP address) to establish the source of events.
      meta:
        stig: ndm
        severity: low
      test: system_hostname and system_syslog_hostname in ["FQDN", "hostname", "ipv4-address", "ipv6-address"]
      fail_message: |
        {% if not system_hostname %}A unique hostname must be configured{% endif %}
        {% if not system_syslog_hostname in ["FQDN", "hostname", "ipv4-address", "ipv6-address"] %}Vaild selection required for syslog hostname format.{% endif %}
      pass_message: Validation successful, operator should validate hostname to be globally unique.
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62713
      tags:
        - PANW-NW-000029

    - name: PANW-NM-000042
      label: The Palo Alto Networks security platform must back up audit records at least every seven days onto a different system or system component than the system or component being audited.
      meta:
        stig: ndm
        severity: low
      test: |
        system_syslog and valid_traffic_syslog_profile_names and valid_threat_syslog_profile_names and valid_config_syslog_profile_names
        and (
          'All Logs' in system_syslog_filters
          or ( 'critical' in system_syslog_filters and 'high' in system_syslog_filters and 'medium' in system_syslog_filters and 'low' in system_syslog_filters)
        )
      fail_message: |
        {% if not system_syslog %}Missing system syslog settings
        {% elif not valid_traffic_syslog_profile_names %}Missing syslog profiles for traffic logs
        {% elif not valid_threat_syslog_profile_names %}Missing syslog profiles for threat logs
        {% elif not valid_config_syslog_profile_names %}Missing syslog profiles for config logs
        {% else %}All required traffic types not accounted for in system syslog settings, click link to review.{% endif %}
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62715
      tags:
        - PANW-NW-000042

    - name: capture_system_services
      cmd: parse
      variable: config
      outputs:
        - name: system_services
          capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/service
        - name: system_snmp_v3
          capture_value: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/snmp-setting/access-setting/version/v3
        - name: snmp_profiles_not_v3_names
          capture_value: /config/shared/log-settings/snmptrap/entry[not(version/v3)]/@name
      tags:
        - PANW-NM-000046
        - PANW-NM-000118

    - name: PANW-NM-000046
      label: The Palo Alto Networks security platform must be configured to prohibit the use of all unnecessary and/or nonsecure functions, ports, protocols, and/or services, as defined in the PPSM CAL and vulnerability assessments.
      meta:
        stig: ndm
        severity: medium
      test: |
        (
          system_services.service['disable-telnet'] == 'yes'
          and ( not system_services.service['disable-http-ocsp'] == 'no' or permit_http_ocsp )
          and ( not system_services.service['disable-userid-syslog-listener-ssl'] == 'no' or permit_userid_syslog_listener_ssl)
          and ( not system_services.service['disable-userid-service'] == 'no' or permit_userid)
        ) and system_snmp_v3
      fail_message: |
        {% if not system_snmp_v3 %}System is not set to use SNMPv3.{% endif %}
        Unauthorized protocols are enabled on management port, click link for details.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62717
      tags:
        - PANW-NW-000046

    - name: PANW-NM-000047
      label: The Palo Alto Networks security platform must uniquely identify and authenticate organizational administrators (or processes acting on behalf of organizational administrators).
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62719
      tags:
        - PANW-NW-000047

    - name: get_system_info
      include: shared_snippets
      include_snippets:
        - name: get_system_info
      tags:
        - PANW-NM-000051

    - name: PANW-NM-000051
      label: The Palo Alto Networks security platform must implement replay-resistant authentication mechanisms for network access to privileged accounts.
      meta:
        stig: ndm
        severity: medium
      test: operational_mode == 'fips-cc' and (not centralized_authentication == 'ldap')
      fail_message: "{% if not operational_mode == 'fips-cc' %}NGFW must be running in FIPS mode{% else %}Radius requires SSL{% endif %}"
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62721
      tags:
        - PANW-NW-000051

    - name: capture_password_complexity
      include: CIS_NGFW_benchmark_v90
      include_snippets:
        - name: capture_password_complexity_min_length
        - name: capture_password_complexity_reuse_limit
        - name: capture_password_complexity_min_uppercase
        - name: capture_password_complexity_min_lowercase
        - name: capture_password_complexity_min_numeric
        - name: capture_password_complexity_min_special_chars
        - name: capture_password_complexity_new_password_differs
        - name: capture_disable_http_telnet_for_mgmt_intf
        - name: capture_password_complexity_change_period
        - name: capture_admin_idle_timeout
      tags:
        - PANW-NM-000053
        - PANW-NM-000054
        - PANW-NM-000055
        - PANW-NM-000056
        - PANW-NM-000057
        - PANW-NM-000058
        - PANW-NM-000061
        - PANW-NM-000069
        - PANW-NM-000117

    - name: PANW-NM-000053
      label: If multifactor authentication is not available and passwords must be used, the Palo Alto Networks security platform must enforce a minimum 15-character password length.
      meta:
        stig: ndm
        severity: medium
      test: password_min_length == "15"
      fail_message: Minimum password length must be set to 15
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62723
      tags:
        - PANW-NW-000053

    - name: PANW-NM-000054
      label: If multifactor authentication is not available and passwords must be used, the Palo Alto Networks security platform must prohibit password reuse for a minimum of five generations.
      meta:
        stig: ndm
        severity: medium
      test: password_history_count == "5"
      fail_message: Prevent password reuse limit must be 5.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62725
      tags:
        - PANW-NW-000054

    - name: PANW-NM-000055
      label: If multifactor authentication is not available and passwords must be used, the Palo Alto Networks security platform must enforce password complexity by requiring that at least one upper-case character be used.
      meta:
        stig: ndm
        severity: medium
      test: password_min_uppercase == "1"
      fail_message: Minimum uppercase letters must be 1.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62727
      tags:
        - PANW-NW-000055

    - name: PANW-NM-000056
      label: If multifactor authentication is not available and passwords must be used, the Palo Alto Networks security platform must enforce password complexity by requiring that at least one lower-case character be used.
      meta:
        stig: ndm
        severity: medium
      test: password_min_lowercase == "1"
      fail_message: Minimum lowercase letters must be 1.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62729
      tags:
        - PANW-NW-000056

    - name: PANW-NM-000057
      label: If multifactor authentication is not available and passwords must be used, the Palo Alto Networks security platform must enforce password complexity by requiring that at least one numeric character be used.
      meta:
        stig: ndm
        severity: medium
      test: password_min_numeric == "1"
      fail_message: Minimum numeric letters must be 1.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62731
      tags:
        - PANW-NW-000057

    - name: PANW-NM-000058
      label: If multifactor authentication is not available and passwords must be used, the Palo Alto Networks security platform must enforce password complexity by requiring that at least one special character be used.
      meta:
        stig: ndm
        severity: medium
      test: password_min_special == "1"
      fail_message: Minimum special characters must be 1.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62733
      tags:
        - PANW-NW-000058

    - name: PANW-NM-000059
      label: If multifactor authentication is not available and passwords must be used, the Palo Alto Networks security platform must require that when a password is changed, the characters are changed in at least 8 of the positions within the password.
      meta:
        stig: ndm
        severity: medium
      test: password_differs_by_char == "8"
      fail_message: ew Password Differs By Characters" must be set to 8
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62735
      tags:
        - PANW-NW-000059

    - name: PANW-NM-000061
      label: The Palo Alto Networks security platform must prohibit the use of unencrypted protocols for network access to privileged accounts.
      meta:
        stig: ndm
        severity: medium
      test: mgmt_disable_http != 'no' and mgmt_disable_telnet != 'no'
      fail_message: HTTP and telnet must be disabled for system management.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62737
      tags:
        - PANW-NW-000061

    - name: capture_password_complexity_block_change_period
      cmd: parse
      variable: config
      outputs:
        - name: password_change_period_block
          capture_value: /config/mgt-config/password-complexity/password-change-period-block/text()
      tags:
        - PANW-NW-000062

    - name: PANW-NM-000062
      label: The Palo Alto Networks security platform must enforce 24 hours/1 day as the minimum password lifetime.
      meta:
        stig: ndm
        severity: medium
      test: password_change_period_block == "1"
      fail_message: Block Password Change Period (days) must be set to 1
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62739
      tags:
        - PANW-NW-000062

    - name: PANW-NM-000063
      label: The Palo Alto Networks security platform must enforce a 60-day maximum password lifetime restriction.
      meta:
        stig: ndm
        severity: medium
      test: password_min_change_period == "60"
      fail_message: Required Password Change Period (days) must be set to 60 
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62741
      tags:
        - PANW-NW-000063

    - name: PANW-NM-000069
      label: The Palo Alto Networks security platform must terminate management sessions after 10 minutes of inactivity except to fulfill documented and validated mission requirements.
      meta:
        stig: ndm
        severity: high
      test: authorized_no_idle_timeout or admin_idle_timeout | int <= 10
      fail_message: Admin idle timeout must be 10 minutes or less if no documentation is provided authorizing otherwise
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62743
      tags:
        - PANW-NW-000069

    - name: PANW-NM-000075
      label: Administrators in the role of either Security Administrator or Cryptographic Administrator must not also have the role of Audit Administrator.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62745
      tags:
        - PANW-NW-000075

    - name: capture_admin_user_lockout_time
      cmd: parse
      variable: config
      outputs:
        - name: vaild_lockout_time_authentication_profiles
          capture_list: /config/shared/authentication-profile/entry[lockout/lockout-time=0]/@name
        - name: invalid_lockout_time_admin_users
          capture_list: /config/mgt-config/users/entry[not(@name="{{ emergency_admin_account }}")]
          filter_items: item | json_query('entry."authentication-profile"') not in vaild_lockout_time_authentication_profiles
      tags:
        - PANW-NM-000092

    - name: PANW-NM-000092
      label: The Palo Alto Networks security platform must automatically lock the account until the locked account is released by an administrator when three unsuccessful logon attempts in 15 minutes are exceeded.
      meta:
        stig: ndm
        severity: medium
      test: not invalid_lockout_time_admin_users
      fail_message: Users with invalid lockout-time settings - {% for user in invalid_lockout_time_admin_users %}{{ user.entry["@name"] }}{% endfor %}
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62747
      tags:
        - PANW-NW-000092

    - name: capture_system_alarm_settings
      cmd: parse
      variable: config
      outputs:
        - name: system_alarm_settings
          capture_object: /config/devices/entry[@name="localhost.localdomain"]/deviceconfig/setting/management/common-criteria-alarm-generation
        - name: system_alarm_thresholds
          capture_expression: system_alarm_settings | json_query('"common-criteria-alarm-generation"."log-databases-alarm-threshold"')
      tags:
        - PANW-NM-000096
        - PANW-NM-000097

    - name: PANW-NM-000096
      label: The Palo Alto Networks security platform must generate an immediate alert when allocated audit record storage volume reaches 75% of repository maximum audit record storage capacity.
      meta:
        stig: ndm
        severity: low
      test: |
        system_alarm_settings["common-criteria-alarm-generation"]["enable-alarm-generation"] == "yes"
        and system_alarm_thresholds.traffic == "75"
        and system_alarm_thresholds.threat == "75"
        and system_alarm_thresholds.config == "75"
        and system_alarm_thresholds.system == "75"
        and system_alarm_thresholds.alarm == "75"
        and system_alarm_thresholds.hipmatch == "75"
      fail_message: Traffic, threat, config, system, alarm, and hipmatch DB thresholds must be set to 75, click link for info.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62749
      tags:
        - PANW-NW-000096

    - name: PANW-NM-000097
      label: The Palo Alto Networks security platform must have alarms enabled.
      meta:
        stig: ndm
        severity: low
      test: system_alarm_settings["common-criteria-alarm-generation"]["enable-alarm-generation"] == "yes"
      fail_message: Device -> Log Settings -> Alarms -> Enable Alarms must be checked
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62751
      tags:
        - PANW-NW-000097

    - name: capture_redundant_ntp_servers_configured
      include: CIS_NGFW_benchmark_v90
      include_snippets:
        - name: capture_redundant_ntp_servers_configured
      tags:
        - PANW-NW-000098
        - PANW-NW-000099
        - PANW-NW-000100

    - name: PANW-NM-000098
      label: The Palo Alto Networks security platform must compare internal information system clocks at least every 24 hours with an authoritative time server.
      meta:
        stig: ndm
        severity: low
      test: ntp_servers | tag_present('primary-ntp-server.ntp-server-address') and ntp_servers | tag_present('secondary-ntp-server.ntp-server-address')
      fail_message: NGFW must have a primary and a secondary NTP server configured.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62753
      tags:
        - PANW-NW-000098

    - name: PANW-NM-000099
      label: The Palo Alto Networks security platform must synchronize internal information system clocks to the authoritative time source when the time difference is greater than one second.
      meta:
        stig: ndm
        severity: low
      test: ntp_servers | tag_present('primary-ntp-server.ntp-server-address') and ntp_servers | tag_present('secondary-ntp-server.ntp-server-address')
      fail_message: NGFW must have a primary and a secondary NTP server configured.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62755
      tags:
        - PANW-NW-000099

    - name: PANW-NM-000100
      label: The Palo Alto Networks security platform must be configured to synchronize internal information system clocks with the primary and secondary time sources located in different geographic regions using redundant authoritative time sources.
      meta:
        stig: ndm
        severity: medium
      test: |
        ntp_servers | tag_present('primary-ntp-server.ntp-server-address')
        and ntp_servers | tag_present('secondary-ntp-server.ntp-server-address')
        and admin_verified_ntp_geographic_diversity
      fail_message: NGFW must have a primary and a secondary NTP server configured, and admin must confirm NTP servers are in different geographic regions
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62757
      tags:
        - PANW-NW-000100

    - name: capture_time_zone
      cmd: parse
      variable: config
      outputs:
        - name: system_time_zone
          capture_value: /config/devices/entry[@name="localhost.localdomain"]/deviceconfig/system/timezone
      tags:
        - PANW-NM-000101

    - name: PANW-NM-000101
      label: The Palo Alto Networks security platform must record time stamps for audit records that can be mapped to Coordinated Universal Time (UTC) or Greenwich Mean Time (GMT).
      meta:
        stig: ndm
        severity: medium
      test: system_time_zone == "UTC" or system_time_zone == "GMT"
      fail_message: Configured system time zone must be either UTC or GMT
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62759
      tags:
        - PANW-NW-000101

    - name: PANW-NM-000110
      label: The Palo Alto Networks security platform must accept and verify Personal Identity Verification (PIV) credentials.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62761
      tags:
        - PANW-NW-000110

    - name: capture_temporary_password
      cmd: parse
      variable: config
      outputs:
        - name: change_passwrod_at_first_login
          capture_value: /config/mgt-config/password-complexity/password-change-on-first-login
      tags:
        - PANW-NM-000114

    - name: PANW-NM-000114
      label: The Palo Alto Networks security platform must allow the use of a temporary password for system logons with an immediate change to a permanent password.
      meta:
        stig: ndm
        severity: medium
      test: change_passwrod_at_first_login == "yes"
      fail_message: The "Require Password Change on First Login" box must be checked
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62763
      tags:
        - PANW-NW-000114

    - name: PANW-NM-000117
      label: The Palo Alto Networks security platform must only allow the use of secure protocols that implement cryptographic mechanisms to protect the integrity of maintenance and diagnostic communications for nonlocal maintenance sessions.
      meta:
        stig: ndm
        severity: medium
      test: mgmt_disable_http != 'no' and mgmt_disable_telnet != 'no'
      fail_message: HTTP and telnet must be disabled for system management.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62765
      tags:
        - PANW-NW-000117

    - name: PANW-NM-000118
      label: The Palo Alto Networks security platform must not use SNMP Versions 1 or 2.
      meta:
        stig: ndm
        severity: high
      test: system_snmp_v3 and not snmp_profiles_not_v3_names
      fail_message: |
        {% if snmp_profiles_not_v3_names %}SNMP Profiles not using v3 - {% for prof in snmp_profiles_not_v3_names %}{{ prof }}{% endfor %}
        {% else %} System must be configured to use SNMP v3.{% endif %}
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62767
      tags:
        - PANW-NW-000118

    - name: PANW-NM-000128
      label: The Palo Alto Networks security platform must off-load audit records onto a different system or media than the system being audited.
      meta:
        stig: ndm
        severity: medium
      test: |
        system_syslog and valid_traffic_syslog_profile_names and valid_threat_syslog_profile_names and valid_config_syslog_profile_names
        and (
          'All Logs' in system_syslog_filters
          or ( 'critical' in system_syslog_filters and 'high' in system_syslog_filters and 'medium' in system_syslog_filters and 'low' in system_syslog_filters)
        )
      fail_message: |
        {% if not system_syslog %}Missing system syslog settings
        {% elif not valid_traffic_syslog_profile_names %}Missing syslog profiles for traffic logs
        {% elif not valid_threat_syslog_profile_names %}Missing syslog profiles for threat logs
        {% elif not valid_config_syslog_profile_names %}Missing syslog profiles for config logs
        {% else %}All required traffic types not accounted for in system syslog settings, click link to review.{% endif %}
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62769
      tags:
        - PANW-NW-000128

    - name: PANW-NM-000131
      label: The Palo Alto Networks security platform must use automated mechanisms to alert security personnel to threats identified by authoritative sources (e.g., CTOs) and IAW CJCSM 6510.01B.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62771
      tags:
        - PANW-NW-000131

    - name: capture_centralized_admin_accounts
      cmd: parse
      variable: config
      outputs:
        # Kerberos
        - name: kerberos_authentication_profiles
          capture_list: /config/shared/authentication-profile/entry[single-sign-on/kerberos-keytab]/@name
        - name: kerberos_accounts
          capture_list: /config/mgt-config/users/entry[not(@name="{{ emergency_admin_account }}")]
          filter_items: item.entry["authentication-profile"] in kerberos_authentication_profiles
        - name: non_kerberos_accounts
          capture_list: /config/mgt-config/users/entry[not(@name="{{ emergency_admin_account }}")]
          filter_items: item.entry["authentication-profile"] not in kerberos_authentication_profiles
        # LDAP
        - name: ldap_authentication_profiles
          capture_list: /config/shared/authentication-profile/entry[method/ldap/server-profile]/@name
        - name: ldap_accounts
          capture_list: /config/mgt-config/users/entry[not(@name="{{ emergency_admin_account }}")]
          filter_items: item.entry["authentication-profile"] in ldap_authentication_profiles
        - name: non_ldap_accounts
          capture_list: /config/mgt-config/users/entry[not(@name="{{ emergency_admin_account }}")]
          filter_items: item.entry["authentication-profile"] not in ldap_authentication_profiles
        # RADIUS
        - name: radius_authentication_profiles
          capture_list: /config/shared/authentication-profile/entry[method/radius/server-profile]/@name
        - name: radius_accounts
          capture_list: /config/mgt-config/users/entry[not(@name="{{ emergency_admin_account }}")]
          filter_items: item.entry["authentication-profile"] in radius_authentication_profiles
        - name: non_radius_accounts
          capture_list: /config/mgt-config/users/entry[not(@name="{{ emergency_admin_account }}")]
          filter_items: item.entry["authentication-profile"] not in radius_authentication_profiles
      tags:
        - PANW-NW-000136

    - name: PANW-NM-000136
      label: The Palo Alto Networks security platform must employ centrally managed authentication server(s).
      meta:
        stig: ndm
        severity: medium
      test: |
        ( centralized_authentication == "kerberos" and kerberos_accounts and not non_kerberos_accounts )
        or ( centralized_authentication == "ldap" and ldap_accounts and not non_ldap_accounts )
        or ( centralized_authentication == "radius" and radius_accounts and not non_radius_accounts )
      fail_message: |
        {% if centralized_authentication == "kerberos"%}
          {% if not kerberos_accounts %}Kerberos selected but found no kerberos admin users{% else %}
            Kerberos selected but found non kerberos admin accounts - {% for account in non_kerberos_accounts %}{{ account.entry["@name"] }} {% endfor %}
          {% endif %}
        {% elif centralized_authentication == "ldap"%}
          {% if not ldap_accounts %}LDAP selected but found no LDAP admin users{% else %}
            LDAP selected but found non LDAP admin accounts - {% for account in non_ldap_accounts %}{{ account.entry["@name"] }} {% endfor %}
          {% endif %}
        {% elif centralized_authentication == "radius"%}
          {% if not radius_accounts %}RADIUS selected but found no RADIUS admin users{% else %}
            RADIUS selected but found non RADIUS admin accounts - {% for account in non_radius_accounts %}{{ account.entry["@name"] }} {% endfor %}
          {% endif %}
        {% endif %}
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62773
      tags:
        - PANW-NW-000136

    - name: PANW-NM-000141
      label: The Palo Alto Networks security platform must use DoD-approved PKI rather than proprietary or self-signed device certificates.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62777
      tags:
        - PANW-NW-000141

    - name: PANW-NM-000142
      label: The Palo Alto Networks security platform must not use Password Profiles.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62779
      tags:
        - PANW-NW-000142

    - name: PANW-NM-000143
      label: The Palo Alto Networks security platform must not use the default admin account password.
      meta:
        stig: ndm
        severity: high
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62781
      tags:
        - PANW-NW-000143

    - name: PANW-NM-000144
      label: The Palo Alto Networks security platform must generate an audit log record when the Data Plane CPU utilization is 100%.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62783
      tags:
        - PANW-NW-000144

    - name: PANW-NM-000145
      label: The Palo Alto Networks security platform must authenticate Network Time Protocol sources.
      meta:
        stig: ndm
        severity: medium
      test: false
      fail_message: Click link for remediation instruction.
      pass_message: Validation successful
      documentation_link: https://www.stigviewer.com/stig/palo_alto_networks_ndm/2019-12-20/finding/V-62785
      tags:
        - PANW-NW-000145